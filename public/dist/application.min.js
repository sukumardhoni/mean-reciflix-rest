"use strict";function pageTitle($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState,toParams,fromState,fromParams){var title="ReciFlix";toState.data&&toState.data.pageTitle&&(title="ReciFlix "),$timeout(function(){element.text(title)})};$rootScope.$on("$stateChangeStart",listener)}}}function sideNavigation($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.metisMenu()})}}}function iboxTools($timeout){return{restrict:"A",scope:!0,templateUrl:"modules/categories/views/common/ibox_tools.html",controller:["$scope","$element",function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.find("div.ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){$element.closest("div.ibox").remove()}}]}}function minimalizaSidebar($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:["$scope","$element",function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),$("body").hasClass("mini-navbar")?$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("body").addClass("fixed-sidebar"),$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:.9}),$("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(900)},100)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},300)):$("#side-menu").removeAttr("style"):($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},100))}}]}}function fix_height(){var heightWithoutNavbar=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",heightWithoutNavbar+"px");var windowHeight=$(window).height();$("#page-wrapper").css("min-height",windowHeight+"px")}pageTitle.$inject=["$rootScope","$timeout"],sideNavigation.$inject=["$timeout"],iboxTools.$inject=["$timeout"],minimalizaSidebar.$inject=["$timeout"];var ApplicationConfiguration=function(){var applicationModuleName="reciflixApp";return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","ngStorage","ngFileUpload","ui.select","updateMeta","720kb.socialshare","angular-web-notification"],registerModule:function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)}}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]).run(["$rootScope","$state","$localStorage","$http","$location",function($rootScope,$state,$localStorage,$http,$location){var is_chrome=navigator.userAgent.indexOf("Chrome")>-1,is_explorer=navigator.userAgent.indexOf("MSIE")>-1,is_firefox=navigator.userAgent.indexOf("Firefox")>-1,is_safari=navigator.userAgent.indexOf("Safari")>-1,is_opera=navigator.userAgent.toLowerCase().indexOf("op")>-1,browser="";is_chrome&&is_safari?browser="Chrome":is_chrome&&is_opera?browser="Opera":-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")?browser="Safari":is_firefox?browser="Firefox":is_explorer&&(browser="Explorer");var currentUser=$localStorage.user,userEmail="guest, ip : "+geoplugin_request();currentUser&&(userEmail=currentUser.email),$http.defaults.headers.common.Device="Web,"+browser,$http.defaults.headers.common.Email=userEmail+", country :"+geoplugin_countryName(),$rootScope.$state=$state}]),angular.element(document).ready(function(){1==window.location.hash.indexOf("/")&&(window.location.hash="#!"),"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("categories"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("recipes"),ApplicationConfiguration.registerModule("users"),angular.module("articles").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Articles","articles","dropdown","/articles(/create)?"),Menus.addSubMenuItem("topbar","articles","List Articles","articles"),Menus.addSubMenuItem("topbar","articles","New Article","articles/create")}]),angular.module("articles").config(["$stateProvider",function($stateProvider){$stateProvider.state("listArticles",{url:"/articles",templateUrl:"modules/articles/views/list-articles.client.view.html"}).state("listArticles.users",{url:"/users",views:{"user.detail":{templateUrl:"modules/articles/views/create-article.client.view.html"}}}).state("listArticles.categories",{url:"/categories",views:{"user.categories":{templateUrl:"modules/articles/views/edit-article.client.view.html"}}}).state("listArticles.createcategories",{url:"/createcategories",views:{"user.categories":{templateUrl:"modules/articles/views/createcategories.client.view.html"}}}).state("listArticles.recipes",{url:"/recipes",views:{"user.recipes":{templateUrl:"modules/articles/views/view-article.client.view.html"}}})}]),angular.module("articles").controller("ArticlesController",["$scope","$stateParams","$location","Authentication","Vrecipes","$localStorage","$http",function($scope,$stateParams,$location,Authentication,Vrecipes,$localStorage,$http){$http.defaults.headers.common.Authorization="Basic "+$localStorage.token,$scope.authentication=Authentication,$scope.categories=function(){Vrecipes.getcategory.query({},function(res){$scope.categories=res})},$scope.sample=[{value:"1",name:"nonveg"},{value:"2",name:"vegetarian"},{value:"3",name:"seafood"},{value:"4",name:"snacks"},{value:"5",name:"fastfood"},{value:"6",name:"healthy"},{value:"7",name:"specials"},{value:"8",name:"kids"},{value:"9",name:"beverages"},{value:"10",name:"regional"},{value:"11",name:"desserts"},{id:"12",name:"dairy"},{id:"13",name:"chutneysoups"},{value:"14",name:"appetizers"},{value:"15",name:"kicthentips"}],$scope.createcategories=function(){$scope.newcat=function(){var categorie={catId:this.categorie.catId,displayName:this.categorie.displayName,imageName:this.categorie.imageName};Vrecipes.savecategory.save(categorie,function(result){$scope.categorie=""})}},$scope.availableTags=["Chicken","Mutton","Veg","Non-veg","Curry","Gravy","Salads","Desserts","Cake","Sweets","Snacks","Appetizers","Breads","Dipping Sides","Kids","Festival","Diwali","Ganesh Festival","Sankranthi","Rakhi","Dushera","Healthy","Indo chineese","South Indian Recipes","Soup","Chutney","Indian Pickels","Pregnancy Diet","Egg Less","SandWhich","Fruit","Special","Hot Drinks","Soft Drinks","Lunch","Break Fast","Pasta","Ice-Creams","Chat","Pickle","North-Indian","Spreads","Rice","Cashews Special","Paratha","Chineese","Rajasthani","Naan","Roti","Milk","Biriyani","Pulao","Cookies","Kitchen Requirements","Mushroom","Pizza","Bakery","Chocolates"],$scope.availableCats=["Chicken","Mutton","Veg","nonveg","Curry","Gravy","Salads","Desserts","Cake","Sweets","Snacks","Appetizers","Breads","Dipping Sides","Kids","Festival","Diwali","Ganesh Festival","Sankranthi","Rakhi","Dushera","Healthy","Indo chineese","South Indian Recipes","Soup","Chutney","Indian Pickels","Pregnancy Diet","Egg Less","SandWhich","Fruit","Special","Hot Drinks","Soft Drinks","Lunch","Break Fast","Pasta","Ice-Creams","Chat","Pickle","North-Indian","Spreads","Rice","Cashews Special","Paratha","Chineese","Rajasthani","Naan","Roti","Milk","Biriyani","Pulao","Cookies","Kitchen Requirements","Mushroom","Pizza","Bakery","Chocolates"],$scope.selected=function(){Vrecipes.getrecipes.query({CategoryName:this.categoriesname},function(res){$scope.recipes=res,$scope.totalItems=$scope.recipes.length,$scope.itemsPerPage=1,$scope.currentPage=1,$scope.maxSize=5,$scope.pageCount=function(){return Math.ceil($scope.recipes.length/$scope.itemsPerPage)},$scope.$watch("currentPage + itemsPerPage",function(){var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.filteredrecipe=$scope.recipes.slice(begin,end)})})},$scope.updaterecipes=function(recipe){var updatedRecipe=recipe;updatedRecipe.submitted.by="reciflix_admin",updatedRecipe.state=123,Vrecipes.updaterecipes.update({vrecipeId:updatedRecipe._id},updatedRecipe,function(result){},function(err){})},$scope.removeRecipes=function(recipe){console.log("inside removeRecipes");var updatedRecipe=recipe;updatedRecipe.submitted.by="reciflix_admin",updatedRecipe.state=333,Vrecipes.updaterecipes.update({vrecipeId:updatedRecipe._id},updatedRecipe,function(result){},function(err){})}}]),angular.module("articles").directive("myYoutube",["$sce",function($sce){return{restrict:"EA",scope:{code:"="},replace:!0,template:'<div style="height:350px; width:100%"><iframe style="overflow:hidden;height:100%;width:70%" controls="0" src="{{url}}" frameborder="0" allowfullscreen></iframe></div>',link:function(scope){console.log("here"),scope.$watch("code",function(newVal){newVal&&(scope.url=$sce.trustAsResourceUrl("http://www.youtube.com/embed/"+newVal))})}}}]),angular.module("articles").factory("Vrecipes",["$resource",function($resource){return{getrecipes:$resource("/VRecipesByCategoriesForAdmin/:CategoryName",{CategoryName:"@CategoryName"},{query:{method:"GET",isArray:!0}}),updaterecipes:$resource("/vrecipes/:vrecipeId",{vrecipeId:"@vrecipeId"},{update:{method:"PUT"}}),getcategory:$resource("/categories/admincats",{},{query:{method:"GET",isArray:!0}}),savecategory:$resource("/newcategories",{},{save:{method:"POST"}})}}]),angular.module("categories").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Categories","categories","dropdown","/categories(/create)?"),Menus.addSubMenuItem("topbar","categories","List Articles","categories"),Menus.addSubMenuItem("topbar","categories","New Category","categories/create")}]),angular.module("categories").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("reciflix",{url:"/",templateUrl:"modules/categories/views/common/content.html",controller:"ReciflixCtrl",data:{bodyClass:""}}).state("reciflix.recipesUpdate",{url:"recipes/update",templateUrl:"modules/categories/views/recipesUpdate.html",controller:"RecipesUpdateCtrl"}).state("reciflix.categories",{url:"categories",templateUrl:"modules/categories/views/categories.html",controller:"CategoryCtrl",module:"private"}).state("reciflix.categories.subcats",{url:"/:catId/subcats",views:{"child-view":{templateUrl:"modules/categories/views/subCats.html",controller:"SubCatCtrl"}},module:"private"}).state("reciflix.addrecipes",{url:"addrecipes",templateUrl:"modules/categories/views/addRecipes.html",controller:"RecipesUpdateCtrl",module:"private"})}]).run(["$rootScope","$state","$stateParams","$location",function($rootScope,$state,$stateParams,$location){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.location=$location}]),angular.module("categories").controller("ReciflixCtrl",["$scope","$state","$localStorage","$location","$http","Authentication","$modal",function($scope,$state,$localStorage,$location,$http,Authentication,$modal){$scope.authentication=Authentication,$scope.authentication.user=$localStorage.user,$http.defaults.headers.common.Authorization="Basic "+$localStorage.token,$scope.goToSearchRecipes=function(params){$state.go("reciflix.recipes.searchedrecipes",{query:params})};var currentUser=$localStorage.user,userDisplayName="";currentUser&&(userDisplayName=$localStorage.user.displayName),$scope.userName=userDisplayName,$scope.localUser=$localStorage.user,$scope.signout=function(){$http.defaults.headers.common.Authorization="Basic "+$localStorage.token,$http.post("/users/signout").success(function(response){$scope.authentication.user="",delete $localStorage.token,delete $localStorage.user,$state.go("home")})},$scope.minimalize=function(){$("body").hasClass("body-small")?$("body").removeClass("mini-navbar"):($("body").addClass("mini-navbar"),$("body").addClass("fixed-sidebar"),$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:.9}))},$scope.OpenSignIn=function(){$scope.signFun=!0,$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/signIn-modal.html",controller:"AuthenticationController",backdrop:"static",scope:$scope})},$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")}}]).controller("CategoryCtrl",["$scope","$localStorage","$state","Categories","$modal","SingleCat","Upload","$timeout","ConfigService",function($scope,$localStorage,$state,Categories,$modal,SingleCat,Upload,$timeout,ConfigService){$scope.categoryFun=function(){Categories.query({pageId:999,activeFilter:3}).$promise.then(function(res){$scope.categories=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.openModal=function(){$scope.cat="",$scope.catName="",$scope.modalName="Create Category",$scope.modalBtnName="Create Category",$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/create-cat-modal.html",controller:"CategoryCtrl",backdrop:"static",scope:$scope})},$scope.editCat=function(cat,index){$scope.modalName="Update Category",$scope.modalBtnName="Update Category",$scope.updatingLogo=!0,$localStorage.indexVal=index,$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/create-cat-modal.html",backdrop:"static",scope:$scope,controller:"CategoryCtrl"}),$scope.getCatDetails(cat)},$scope.displayCat=function(cat){$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/view-cat-modal.html",backdrop:"static",scope:$scope,controller:"CategoryCtrl"}),$scope.getCatDetails(cat)},$scope.getCatDetails=function(cat){SingleCat.get({newCatId:cat.catId},function(res){$scope.updatingLogo=!1,$scope.cat=res,$scope.catName=res.displayName},function(err){})},$scope.setFile=function(element){$scope.$apply(function($scope){$scope.theFile=element.files[0]})},$scope.createCat=function(){$scope.isDisabled=!0,$scope.modalBtnName="Creating...",Upload.upload({url:ConfigService.API_URL+"/newcats",file:$scope.cat.picFile,data:$scope.cat}).then(function(resp){$scope.categories.unshift(resp.data),$scope.modalInstance.close()},function(resp){console.log("Error status: "+resp.status)},function(evt){parseInt(100*evt.loaded/evt.total)})},$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")},$scope.updateCat=function(){var indexVal=$localStorage.indexVal;$scope.modalBtnName="Updating...",$scope.isDisabled=!0,Upload.upload({url:ConfigService.API_URL+"/newcats/"+$scope.cat.catId,file:$scope.cat.picFile,data:$scope.cat}).then(function(resp){$scope.categories.splice(indexVal,1),$scope.categories.splice(indexVal,0,resp.data),delete $localStorage.indexVal,$scope.modalInstance.close(),resp.config.data.file&&$timeout(function(){$state.go($state.current,{},{reload:!0})},2e3)},function(resp){console.log("Error status: "+resp.status)},function(evt){parseInt(100*evt.loaded/evt.total)})},$scope.deleteCat=function(cat){$modal.open({templateUrl:"modules/categories/views/modals/del-cat-modal.html",backdrop:"static",scope:$scope,controller:"DelCatCtrl"}).result.then(function(){var indexVal=$localStorage.indexVal;SingleCat.delete({newCatId:cat.catId},function(res){$scope.categories.splice(indexVal,1),delete $localStorage.indexVal,$scope.modalInstance.close()},function(err){}),$scope.modalInstance.dismiss("cancel")},function(){})}}]).controller("DelCatCtrl",["$scope","$modalInstance",function($scope,$modalInstance){$scope.deleteCatConfirm=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("SubCatCtrl",["$scope","$stateParams","SubCategories","$modal","SubCat","$localStorage","Upload","$timeout","$state","ConfigService",function($scope,$stateParams,SubCategories,$modal,SubCat,$localStorage,Upload,$timeout,$state,ConfigService){$scope.subCatFun=function(){SubCategories.query({catId:$stateParams.catId,pageId:999,activeFilter:3}).$promise.then(function(res){$scope.CatObjWithSubCats=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.openCreateSubCatModal=function(){$scope.catName="",$scope.subCat="",$scope.modalName="Create Sub-Category",$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/create-sub-cat-modal.html",backdrop:"static",scope:$scope,controller:"SubCatCtrl"})},$scope.createSubCat=function(){$scope.updatingLogo=!0,Upload.upload({url:ConfigService.API_URL+"/subCats/"+$stateParams.catId+"/999/3",file:$scope.subCat.picFile,data:$scope.subCat}).then(function(resp){$scope.CatObjWithSubCats.subCats.unshift(resp.data),$scope.updatingLogo=!1,$scope.modalInstance.close()},function(resp){console.log("Error status: "+resp.status)},function(evt){parseInt(100*evt.loaded/evt.total)})},$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")},$scope.displaySubCat=function(subCat){$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/view-sub-cat-modal.html",backdrop:"static",scope:$scope,controller:"SubCatCtrl"}),$scope.getSingleSubCat(subCat)},$scope.editSubCat=function(subCat,index){$scope.modalName="Update Sub-Category",$scope.updatingLogo=!0,$scope.subCatName=subCat.displayName,$localStorage.indexVal=index,$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/create-sub-cat-modal.html",backdrop:"static",scope:$scope,controller:"SubCatCtrl"}),$scope.getSingleSubCat(subCat)},$scope.getSingleSubCat=function(subCat,index){SubCat.get({subCatId:subCat.subCatId},function(res){$scope.updatingLogo=!1,$scope.subCat=res},function(err){})},$scope.updateSubCat=function(){$scope.updatingLogo=!0;var indexVal=$localStorage.indexVal;Upload.upload({url:ConfigService.API_URL+"/singleSubCat/"+$scope.subCat.subCatId,file:$scope.subCat.picFile,data:$scope.subCat}).then(function(resp){$scope.CatObjWithSubCats.subCats.splice(indexVal,1),$scope.CatObjWithSubCats.subCats.splice(indexVal,0,resp.data),delete $localStorage.indexVal,$scope.updatingLogo=!1,$scope.modalInstance.close(),resp.config.data.file&&$timeout(function(){$state.go($state.current,{},{reload:!0})},2e3)},function(resp){console.log("Error status: "+resp.status)},function(evt){parseInt(100*evt.loaded/evt.total)})},$scope.deleteSubCat=function(subCat){$modal.open({templateUrl:"modules/categories/views/modals/del-sub-cat-modal.html",backdrop:"static",scope:$scope,controller:"DelSubCatCtrl"}).result.then(function(){var indexVal=$localStorage.indexVal;SubCat.delete({subCatId:subCat.subCatId},function(res){$scope.CatObjWithSubCats.subCats.splice(indexVal,1),delete $localStorage.indexVal,$scope.modalInstance.close()},function(err){}),$scope.modalInstance.dismiss("cancel")},function(){})}}]).controller("DelSubCatCtrl",["$scope","$modalInstance",function($scope,$modalInstance){$scope.deleteSubCatConfirm=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("categories").controller("RecipesUpdateCtrl",["$scope","$state","$localStorage","Recipe","$rootScope","Categories","SubCategories","SubCategoryRecipes","CategoryRecipes","$sce","RecipesService","NotificationFactory",function($scope,$state,$localStorage,Recipe,$rootScope,Categories,SubCategories,SubCategoryRecipes,CategoryRecipes,$sce,RecipesService,NotificationFactory){function convert_time(duration){var a=duration.match(/\d+/g);duration.indexOf("M")>=0&&-1===duration.indexOf("H")&&-1===duration.indexOf("S")&&(a=[0,a[0],0]),duration.indexOf("H")>=0&&-1===duration.indexOf("M")&&(a=[a[0],0,a[1]]),duration.indexOf("H")>=0&&-1===duration.indexOf("M")&&-1===duration.indexOf("S")&&(a=[a[0],0,0]),duration=0,3===a.length&&(duration+=3600*parseInt(a[0]),duration+=60*parseInt(a[1]),duration+=parseInt(a[2])),2===a.length&&(duration+=60*parseInt(a[0]),duration+=parseInt(a[1])),1===a.length&&(duration+=parseInt(a[0]));var h=Math.floor(duration/3600),m=Math.floor(duration%3600/60),s=Math.floor(duration%3600%60);return(h>0?h+"h:"+(m<10?"0":""):"")+m+"m:"+(s<10?"0":"")+s+"s"}$scope.getAllCats=function(){Categories.query({pageId:999,activeFilter:3}).$promise.then(function(res){$scope.cats=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.getSubCats=function(addsubCats){addsubCats&&($scope.catSelected=addsubCats),console.log("Selected cat for sub cats : "+JSON.stringify($scope.catSelected)),SubCategories.query({catId:$scope.catSelected.catId,pageId:999,activeFilter:3}).$promise.then(function(res){res.subCatsExist?$scope.subCats=res.subCats:$scope.getCatRecipes($scope.catSelected.catId)}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.getCatRecipes=function(CatId){CategoryRecipes.query({subCatId:CatId,pageId:999}).$promise.then(function(res){$scope.subCatRecipes=res.recipes,$scope.loading=!1,$scope.itemsPerPage=1,$scope.currentPage=1,$scope.maxSize=5,$scope.$watch("currentPage + itemsPerPage",function(){$scope.faqSingle="";var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.finalitems=$scope.subCatRecipes.slice(begin,end)})}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.getIframeSrc=function(videoId){return $sce.trustAsResourceUrl("http://www.youtube.com/embed/"+videoId)},$scope.availableTags=["Chicken","Mutton","Veg","Non-veg","Curry","Gravy","Salads","Desserts","Cake","Sweets","Snacks","Appetizers","Breads","Dipping Sides","Kids","Festival","Diwali","Ganesh Festival","Sankranthi","Rakhi","Dushera","Healthy","Soft Drinks","Indo chineese","South-Indian","Soup","Chutney","Indian Pickels","Pregnancy Diet","Egg Less","Eggs","Fruits","Prawns"],$scope.availableCats=[],$scope.availableSubCats=[],$scope.getSubCatRecipes=function(subCats){subCats&&($scope.subCatSelected=subCats),$scope.loading=!0,console.log("Selected Sub cat for Recipes : "+JSON.stringify($scope.subCatSelected)),SubCategoryRecipes.query({subCatId:$scope.subCatSelected.subCatId,pageId:999}).$promise.then(function(res){$scope.subCatRecipes=res.recipes,$scope.loading=!1,$scope.itemsPerPage=1,$scope.currentPage=1,$scope.maxSize=5,$scope.$watch("currentPage + itemsPerPage",function(){$scope.faqSingle="";var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.finalitems=$scope.subCatRecipes.slice(begin,end)})}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.pageChanged=function(){$scope.UpdateMsg=!1},$scope.updateRecipeItem=function(item){item.submitted.by=$localStorage.user.displayName,Recipe.update({vrecipeId:item.recipeId},item,function(){$scope.UpdateMsg=!0},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.deleteRecipe=function(item){item.submitted.by=$localStorage.user.displayName,item.state=1111,Recipe.update({vrecipeId:item.recipeId},item,function(res){$scope.UpdateMsg=!0},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.recipe={},$scope.addRecipe=function(){$scope.showSpinner=!0,console.log("viedeo id : "+JSON.stringify($scope.recipe.recipeVedioIds));var regEx=/([^,]+)/g,result=$scope.recipe.recipeVedioIds.match(regEx);console.log("result : "+JSON.stringify(result));for(var i=0;i<result.length;i++)$scope.youtubeApi(result[i]),console.log("result Single obj: "+JSON.stringify(result[i]));$scope.showSpinner=!1,$scope.recipe.recipeVedioIds=""},$scope.errVideos=[],$scope.youtubeApi=function(videoId){if(console.log("youtubeApi: "+JSON.stringify(videoId)),videoId){var apiKey="AIzaSyA4LdL9Gbg1ww3vtOm-_nkofFXE1uxZpXk",gUrl="https://www.googleapis.com/youtube/v3/videos?id="+videoId+"&key="+apiKey+"&part=snippet,statistics,contentDetails";$.get(gUrl,function(data){console.log("sucess call."+JSON.stringify(data.items)),0===data.items.length?(console.log("item  empty array"),$scope.errVideos.push(videoId),$scope.$apply(function(){$scope.errVideos,$scope.errMsg="Recipe's not uploaded with this videoId's"})):($scope.formObject(data),console.log("item non  empty array"))}).error(function(data,status,headers,config){$scope.errMsg="the following recipe is not saved with videoId "+videoId,console.log("Error while saving this Video Id details in rest."+JSON.stringify(data)),console.log("Error while saving this Video Id details in rest."+videoId)})}},$scope.formObject=function(data){console.log("catSelected"+JSON.stringify($scope.catSelected)),console.log("subCatSelected"+JSON.stringify($scope.subCatSelected)),console.log("local user "+JSON.stringify($localStorage.user)),$scope.mvObjt={},$scope.mvObjt.submitted={},$scope.mvObjt.subcats=[],0==$scope.catSelected.subCatsExist?(console.log("if "),$scope.mvObjt.subcats=[]):(console.log("else"),$scope.mvObjt.subcats.push($scope.subCatSelected.subCatId)),$scope.mvObjt.cats=[],$scope.mvObjt.categories=[];var videoData=data.items[0];$scope.mvObjt.title=videoData.snippet.title,$scope.mvObjt.recipeId=videoData.snippet.title.replace(/\s/g,"-"),$scope.mvObjt.videoId=videoData.id,$scope.mvObjt.author=videoData.snippet.channelTitle,$scope.mvObjt.published=videoData.snippet.publishedAt,$scope.mvObjt.submitted.by=$localStorage.user.displayName,$scope.mvObjt.submitted.data=new Date,$scope.mvObjt.duration=parseInt(convert_time(videoData.contentDetails.duration)),$scope.mvObjt.views=videoData.statistics.viewCount,$scope.mvObjt.rank=0,$scope.mvObjt.likes=videoData.statistics.likeCount,$scope.mvObjt.dislikes=videoData.statistics.dislikeCount,$scope.mvObjt.ytlikes=videoData.statistics.likeCount,$scope.mvObjt.applikes=0,$scope.mvObjt.rfpoints=0,$scope.mvObjt.description=videoData.snippet.description,$scope.mvObjt.notes="added new notes",$scope.mvObjt.state=0,$scope.mvObjt.active=$scope.catSelected.active,$scope.mvObjt.tags=videoData.snippet.tags,$scope.mvObjt.cats.push($scope.catSelected.catId),$scope.mvObjt.categories.push($scope.catSelected.catId);var dfltImg="https://i1.ytimg.com/vi/"+videoData.id+"/default.jpg",mqdfltImg="https://i1.ytimg.com/vi/"+videoData.id+"/mqdefault.jpg",hqdfltImg="https://i1.ytimg.com/vi/"+videoData.id+"/hqdefault.jpg",sddfltImg="https://i1.ytimg.com/vi/"+videoData.id+"/sddefault.jpg",maxresdfltImg="https://i1.ytimg.com/vi/"+videoData.id+"/sddefault.jpg";$scope.mvObjt.images={dft:dfltImg,mq:mqdfltImg,hq:hqdfltImg,sd:sddfltImg,maxres:maxresdfltImg},console.log("form object data "+JSON.stringify($scope.mvObjt)),RecipesService.save($scope.mvObjt,function(res){NotificationFactory.success("New recipes Added sucessfully"),console.log("Successfully updated Recipe"+JSON.stringify(res))},function(errorResponse){console.log("errorResponse "+JSON.stringify(errorResponse)),$scope.error=errorResponse.data.message})}}]),angular.module("categories"),angular.module("categories").directive("pageTitle",pageTitle).directive("sideNavigation",sideNavigation).directive("iboxTools",iboxTools).directive("minimalizaSidebar",minimalizaSidebar),angular.module("categories").service("ConfigService",["$window",function($window){return $window.location.host.match(/reciflix\.com/)?(this.API_URL="http://www.reciflix.com",this.API_URL):$window.location.host.match(/202.83.31.92\:3000/)?(this.API_URL="http://202.83.31.92:3000",this.API_URL):(this.API_URL="http://"+$window.location.host,this.API_URL)}]).factory("Categories",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/newcats/page/:pageId/:activeFilter",{pageId:"@pageId",activeFilter:"@activeFilter"},{query:{method:"GET",isArray:!0,timeout:2e4}})}]).factory("SingleCat",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/newcats/:newCatId",{newCatId:"@newCatId"},{save:{method:"POST"},get:{method:"GET"},update:{method:"PUT"},delete:{method:"DELETE"}})}]).factory("SubCategories",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/subCats/:catId/:pageId/:activeFilter",{catId:"@catId",pageId:"@pageId",activeFilter:"@activeFilter"},{query:{method:"GET",timeout:2e4},save:{method:"POST"}})}]).factory("SubCat",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/singleSubCat/:subCatId",{subCatId:"@subCatId"},{update:{method:"PUT"},get:{method:"GET"},delete:{method:"DELETE"}})}]).factory("NotificationFactory",function(){return toastr.options={closeButton:!0,debug:!1,progressBar:!0,positionClass:"toast-top-right",onclick:null,showDuration:"400",hideDuration:"1000",timeOut:"7000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},{success:function(msg,title){toastr.success(msg,title)},error:function(msg,title){toastr.error(msg,title)}}}).factory("RecipesService",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/nVRecipes",{},{save:{method:"POST"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/home"),$stateProvider.state("home",{url:"/home",templateUrl:"modules/core/views/home.client.view.html",data:{bodyClass:"bg-body"}}).state("reciflix.sendWebNotifications",{url:"send-notifications",templateUrl:"modules/core/views/sendNotifications.html",controller:"HomeController"}).state("privacy",{url:"/privacy",templateUrl:"modules/core/views/privacy.client.view.html",module:"public",data:{bodyClass:""}})}]).run(["$rootScope","$state","$stateParams","WebNotificationSubscription",function($rootScope,$state,$stateParams,WebNotificationSubscription){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus","$http","$location","$localStorage","$modal","$timeout","$state",function($scope,Authentication,Menus,$http,$location,$localStorage,$modal,$timeout,$state){$scope.authentication=Authentication,$scope.authentication.user=$localStorage.user,$scope.gotoState=function(){$scope.authentication.user?$state.go("reciflix.recipes"):$state.go("home")},$scope.presentYear=new Date,$scope.goToSearchRecipes=function(inputQuery){$state.go("reciflix.recipes.searchedrecipes",{query:inputQuery}),$scope.inputQuery=""},$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1}),$scope.OpenSignIn=function(){$scope.signFun=!0,$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/signIn-modal.html",controller:"AuthenticationController",backdrop:"static",scope:$scope}),$timeout(function(){$scope.signFun=!1},3e3)},$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")},$scope.signout=function(){$http.defaults.headers.common.Authorization="Basic "+$localStorage.token,$http.post("/users/signout").success(function(response){$scope.authentication.user="",delete $localStorage.token,delete $localStorage.user,$state.go("home")})}}]),
angular.module("core").controller("HomeController",["$scope","Authentication","$modal","$timeout","NotificationFactory","$localStorage","sendNotificationsService","SendAwsMsg",function($scope,Authentication,$modal,$timeout,NotificationFactory,$localStorage,sendNotificationsService,SendAwsMsg){$localStorage.reciflix_visited||(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)||NotificationFactory.success("Browse All Yummy Recipes here...","Welcome to ReciFlix"),$localStorage.reciflix_visited=!0),$scope.authentication=Authentication,navigator.userAgent.match(/Android/i)?$scope.androidUser=!0:(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))&&($scope.iosUser=!0),$scope.OpenSignIn=function(){$scope.signFun=!0,$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/signIn-modal.html",controller:"AuthenticationController",backdrop:"static",scope:$scope}),$timeout(function(){$scope.signFun=!1},3e3)},$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")},$scope.pushNotification={platform:!1},$scope.pushnotification=function(){console.log("PUSH NOTIFICATIONS :"+JSON.stringify($scope.pushNotification)),SendAwsMsg.send($scope.pushNotification,function(res){console.log("Succesfully send aws message : "+JSON.stringify(res))},function(err){console.log("Error on send aws message")})},$scope.sendNotifications=function(webNotification){if(console.log("VVBB@@@ : "+JSON.stringify(webNotification)),webNotification.url){var notificationObj={title:webNotification.title,message:webNotification.msg,icon:"https://lh3.googleusercontent.com/BCOE0vqCfr8aqpIKEF7QEt-qa7p8I7KDg58Juz6M6_YGb4l7phrO2vMvi_SDy10ucQ=w300",url:webNotification.url};sendNotificationsService.send(notificationObj,function(res){console.log("successfull calback : "+JSON.stringify(res)),$scope.webNotification={}},function(err){console.log("error of sending notification : "+JSON.stringify(err))})}},"serviceWorker"in navigator&&"PushManager"in window?(console.log("Service Worker and Push is supported"),Notification.requestPermission(function(permission){if(console.log("request premission : "+JSON.stringify(permission)),"granted"===Notification.permission){navigator.serviceWorker.register("sw.js").then(function(reg){console.log("Service Worker is registered",reg),navigator.serviceWorker.ready.then(function(register){register.pushManager.getSubscription().then(function(userSubscription){function urlB64ToUint8Array(base64String){const padding="=".repeat((4-base64String.length%4)%4),base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/"),rawData=window.atob(base64),outputArray=new Uint8Array(rawData.length);for(var f=0;f<rawData.length;++f)outputArray[f]=rawData.charCodeAt(f);return outputArray}if(console.log("subscription obj : "+userSubscription),void 0==userSubscription||null==userSubscription){console.log("@@user not subscribed");var applicationServerKey=urlB64ToUint8Array("BCZLs69d4JA_FD9LyXugozgVdBCL1vHwKEBVlaW1M46fLIJ64tC2DWZ33xxr3t5uO8jEPrJCND4Q8LEOFQnxo0g");register.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:applicationServerKey}).then(function(subscription){console.log("user now subscribed to push messages : "+JSON.stringify(subscription)),WebNotificationSubscription.send(subscription,function(res){console.log("@##$$$%% Coming to successfull calback : "+JSON.stringify(res))},function(err){console.log("@##$$$%% Coming to error calback : "+JSON.stringify(err))})}).catch(function(error){console.error("error while subscribing",error)})}else console.log("@@user subscribed")})})}).catch(function(error){console.error("Service Worker Error",error)})}})):console.warn("Push messaging is not supported")}]),$(document).ready(function(){fix_height()}),$(window).bind("load resize click scroll",function(){$("body").hasClass("body-small")||fix_height()}),$(window).bind("load resize",function(){$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")}),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||void 0===isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||void 0===roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||void 0===isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||void 0===roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("core").factory("ProspectiveEmail",["$resource",function($resource){return{emailPost:$resource("/ProspectiveEmails",{},{save:{method:"POST"}}),emailGet:$resource("/ProspectiveEmails/count/:platform",{platform:"@platform"},{query:{method:"GET"}})}}]).factory("WebNotificationSubscription",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/add-dataTo-subscriptionDb",{},{send:{method:"POST"}})}]).factory("sendNotificationsService",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/send-notificationTo-users",{},{send:{method:"POST"}})}]).factory("SendAwsMsg",["$resource",function($resource){return $resource("api/aws-send-message-to-all-devices",{},{send:{method:"POST"}})}]),angular.module("recipes").config(["$stateProvider",function($stateProvider){$stateProvider.state("reciflix.recipes",{url:"category",templateUrl:"modules/recipes/views/recipes.html",controller:"RecipesCtrl"}).state("reciflix.recipes.subcats",{url:"/:catId/subcats",views:{"child-view@reciflix.recipes":{templateUrl:"modules/recipes/views/subCats.html",controller:"SubCategoriesCtrl"}}}).state("reciflix.recipes.searchedrecipes",{url:"/searched/:query/recipes",views:{"child-view@reciflix.recipes":{templateUrl:"modules/recipes/views/searchedRecipes.html",controller:"SearchedRecipesCtrl"}}}).state("reciflix.recipes.favRecipes",{url:"/favorite/recipes",views:{"child-view@reciflix.recipes":{templateUrl:"modules/recipes/views/favoriteRecipes.html",controller:"myFavoritesCtrl"}}}).state("reciflix.recipes.catrecipes",{url:"/:CatIdForRecipes/recipes",views:{"child-view@reciflix.recipes":{templateUrl:"modules/recipes/views/subCatsRecipes.html",controller:"SubCatRecipesCtrl"}}}).state("reciflix.recipes.subcats.recipes",{url:"/:subCatId",views:{"child-recipes-view@reciflix.recipes.subcats":{templateUrl:"modules/recipes/views/subCatsRecipes.html",controller:"SubCatRecipesCtrl"}}}).state("reciflix.recipes.subcats.recipes.singlerecipes",{url:"/:recipeId",views:{"child-singlerecipes-view":{templateUrl:"modules/recipes/views/singleRecipe.html",controller:"SubCatRecipesCtrl"}}}).state("reciflix.recipes.catrecipes.singlerecipes",{url:"/:recipeId",views:{"child-singlerecipes-view":{templateUrl:"modules/recipes/views/singleRecipe.html",controller:"SubCatRecipesCtrl"}}})}]),angular.module("recipes").controller("myFavoritesCtrl",["$scope","$stateParams","$http","MyFavRecipes","$localStorage","Authentication",function($scope,$stateParams,$http,MyFavRecipes,$localStorage,Authentication){$http.defaults.headers.common.Authorization="Basic "+$localStorage.token,$scope.authentication=Authentication,$scope.vm={currentPage:1},$scope.itemsPerPage=6,$scope.maxSize=5,$scope.recipesUnderFavorite=function(pageNum){$scope.loading=!0,MyFavRecipes.query({pageId:pageNum-1,uId:Authentication.user._id},function(res){$scope.loading=!1,1===pageNum&&($scope.totalItems=res.count),$scope.recipes=res.recipes})},$scope.pageChanged=function(){$scope.recipesUnderFavorite($scope.vm.currentPage)}}]),angular.module("recipes").controller("RecipesController",["$scope","$stateParams","$location","Authentication","Vrecipes","$localStorage","$http",function($scope,$stateParams,$location,Authentication,Vrecipes,$localStorage,$http){$http.defaults.headers.common.Authorization="Basic "+$localStorage.token,$scope.authentication=Authentication,$scope.categories=function(){Vrecipes.getcategory.query({},function(res){$scope.categories=res})},$scope.createcategories=function(){$scope.newcat=function(){var categorie={catId:this.categorie.catId,displayName:this.categorie.displayName,imageName:this.categorie.imageName};Vrecipes.savecategory.save(categorie,function(result){$scope.categorie=""})}},$scope.availableTags=["Chicken","Mutton","Veg","Non-veg","Curry","Gravy","Salads","Desserts","Cake","Sweets","Snacks","Appetizers","Breads","Dipping Sides","Kids","Festival","Diwali","Ganesh Festival","Sankranthi","Rakhi","Dushera","Healthy","Indo chineese","South Indian Recipes","Soup","Chutney","Indian Pickels","Pregnancy Diet","Egg Less","SandWhich","Fruit","Special","Hot Drinks","Soft Drinks","Lunch","Break Fast","Pasta","Ice-Creams","Chat","Pickle","North-Indian","Spreads","Rice","Cashews Special","Paratha","Chineese","Rajasthani","Naan","Roti","Milk","Biriyani","Pulao","Cookies","Kitchen Requirements","Mushroom","Pizza","Bakery","Chocolates"],$scope.availableCats=["Chicken","Mutton","Veg","nonveg","Curry","Gravy","Salads","Desserts","Cake","Sweets","Snacks","Appetizers","Breads","Dipping Sides","Kids","Festival","Diwali","Ganesh Festival","Sankranthi","Rakhi","Dushera","Healthy","Indo chineese","South Indian Recipes","Soup","Chutney","Indian Pickels","Pregnancy Diet","Egg Less","SandWhich","Fruit","Special","Hot Drinks","Soft Drinks","Lunch","Break Fast","Pasta","Ice-Creams","Chat","Pickle","North-Indian","Spreads","Rice","Cashews Special","Paratha","Chineese","Rajasthani","Naan","Roti","Milk","Biriyani","Pulao","Cookies","Kitchen Requirements","Mushroom","Pizza","Bakery","Chocolates"],$scope.selected=function(){Vrecipes.getrecipes.query({CategoryName:this.categoriesname},function(res){$scope.recipes=res,$scope.totalItems=$scope.recipes.length,$scope.itemsPerPage=1,$scope.currentPage=1,$scope.maxSize=5,$scope.pageCount=function(){return Math.ceil($scope.recipes.length/$scope.itemsPerPage)},$scope.$watch("currentPage + itemsPerPage",function(){var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.filteredrecipe=$scope.recipes.slice(begin,end)})})},$scope.updaterecipes=function(recipe){var updatedRecipe=recipe;updatedRecipe.submitted.by="reciflix_admin",updatedRecipe.state=123,Vrecipes.updaterecipes.update({vrecipeId:updatedRecipe._id},updatedRecipe,function(result){},function(err){})},$scope.removeRecipes=function(recipe){var updatedRecipe=recipe;updatedRecipe.submitted.by="reciflix_admin",updatedRecipe.state=333,Vrecipes.updaterecipes.update({vrecipeId:updatedRecipe._id},updatedRecipe,function(result){},function(err){})}}]).controller("RecipesCtrl",["$scope","$localStorage","$state","Categories","$modal","SingleCat","NotificationFactory","UserSuggestion","Authentication",function($scope,$localStorage,$state,Categories,$modal,SingleCat,NotificationFactory,UserSuggestion,Authentication){$scope.authentication=Authentication,$scope.categoryFun=function(){"reciflix.recipes"===$state.current.name&&($scope.loading=!0,Categories.query({pageId:999,activeFilter:1}).$promise.then(function(res){$scope.loading=!1,$scope.categories=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")}))},$scope.OpenCreateSuggest=function(){$scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/create-suggestion-modal.html",controller:"RecipesCtrl",scope:$scope})},$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")},$scope.createSuggest=function(){UserSuggestion.save({pageId:0},$scope.suggest,function(res){$scope.modalInstance.close()},function(err){console.log("Error occured while creating suggestion, Error details are : "+JSON.stringify(err))})}}]).controller("SubCategoriesCtrl",["$scope","$stateParams","SubCategories","$modal","$localStorage","$state","Authentication",function($scope,$stateParams,SubCategories,$modal,$localStorage,$state,Authentication){$scope.authentication=Authentication,$scope.catId=$stateParams.catId,$scope.subCatFun=function(){$stateParams.catId&&"reciflix.recipes.subcats"===$state.current.name&&($scope.loading=!0,SubCategories.query({catId:$stateParams.catId,pageId:999,activeFilter:1}).$promise.then(function(res){$scope.loading=!1,$scope.CatObjWithSubCats=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")}))}}]).controller("SubCatRecipesCtrl",["$scope","$stateParams","SubCategoryRecipes","$rootScope","Recipe","$sce","CategoryRecipes","$state","Authentication","FilterBySubCats","FilterByCatRecipes",function($scope,$stateParams,SubCategoryRecipes,$rootScope,Recipe,$sce,CategoryRecipes,$state,Authentication,FilterBySubCats,FilterByCatRecipes){$scope.authentication=Authentication,$scope.catId=$stateParams.catId,$scope.subCatId=$stateParams.subCatId,$scope.CatIdForRecipes=$stateParams.CatIdForRecipes,$scope.filterByLatestSubCats={},$scope.filterByLatestSubCats.lists1=[{name:"Sort by Latest",value:"published"},{name:"Sort by Popular",value:"none"}],$scope.filterByLatestSubCats.List1=$scope.filterByLatestSubCats.lists1[1].value,$scope.socialUrl=function(recipesObj){return $stateParams.subCatId?"http://www.reciflix.com/#!/category/"+$stateParams.catId+"/subcats/"+$stateParams.subCatId+"/"+recipesObj.recipeId:$stateParams.CatIdForRecipes?"http://www.reciflix.com/#!/category/"+$stateParams.CatIdForRecipes+"/recipes/"+recipesObj.recipeId:void 0};var pageNumForFilterSubCats=0,pageNumForFilterCat=0;$scope.recipesFilterByLatest=function(changeValue){$stateParams.subCatId?(console.log("recipesUnderSubCat is called : "+changeValue),"published"==changeValue?($scope.showFilterLoadMoreBtn=!0,FilterBySubCats.query({subCatId:$stateParams.subCatId,pageId:pageNumForFilterSubCats}).$promise.then(function(res){$scope.loading=!1,pageNumForFilterSubCats++,res.catImageUrl=res.subCatsExist?"https://s3.amazonaws.com/NewRF/"+res.imageName:"https://s3.amazonaws.com/NewRFSubCats/"+res.imageName,$scope.subCatRecipesObj=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})):"none"==changeValue&&$scope.recipesUnderSubCat()):$stateParams.CatIdForRecipes&&("published"==changeValue?($scope.showFilterLoadMoreBtn=!0,$scope.loading=!0,FilterByCatRecipes.query({subCatId:$stateParams.CatIdForRecipes,pageId:pageNumForFilterCat}).$promise.then(function(res){pageNumForFilterCat++,$scope.loading=!1,res.catImageUrl=res.subCatsExist?"https://s3.amazonaws.com/NewRFSubCats/"+res.imageName:"https://s3.amazonaws.com/NewRF/"+res.imageName,$scope.subCatRecipesObj=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})):"none"==changeValue&&$scope.recipesUnderSubCat())};var pageNumSubCat=0,pageNumCat=0;$stateParams.subCatId&&($scope.recipesUnderSubCat=function(){$scope.showFilterLoadMoreBtn=!1,$scope.loading=!0,SubCategoryRecipes.query({subCatId:$stateParams.subCatId,pageId:pageNumSubCat}).$promise.then(function(res){$scope.loading=!1,pageNumSubCat++,res.catImageUrl=res.subCatsExist?"https://s3.amazonaws.com/NewRF/"+res.imageName:"https://s3.amazonaws.com/NewRFSubCats/"+res.imageName,$scope.subCatRecipesObj=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})}),$scope.pageChanged=function(){$scope.recipesUnderSubCat($scope.vm.currentPage)},$stateParams.CatIdForRecipes&&($scope.recipesUnderSubCat=function(){$scope.showFilterLoadMoreBtn=!1,$scope.loading=!0,CategoryRecipes.query({subCatId:$stateParams.CatIdForRecipes,pageId:pageNumCat}).$promise.then(function(res){pageNumCat++,$scope.loading=!1,res.catImageUrl=res.subCatsExist?"https://s3.amazonaws.com/NewRFSubCats/"+res.imageName:"https://s3.amazonaws.com/NewRF/"+res.imageName,$scope.subCatRecipesObj=res}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})}),$scope.getSingleRecipe=function(){Recipe.get({vrecipeId:$stateParams.recipeId}).$promise.then(function(res){$scope.singleRecipe=res,$scope.youTubeRecipeURL=$sce.trustAsResourceUrl("http://www.youtube.com/embed/"+res.videoId+"?rel=0&iv_load_policy=3&amp;controls=1&amp;showinfo=0")}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.LoadMoreRecipes=function(){$scope.spinnerLoading=!0;var onScroll={};$stateParams.subCatId&&SubCategoryRecipes.query({subCatId:$stateParams.subCatId,pageId:pageNumSubCat}).$promise.then(function(res){$scope.spinnerLoading=!1,pageNumSubCat++,onScroll=res.recipes,0==res.recipes.length&&($scope.noMoreRecipesAvailable=!0);var oldRecipes=$scope.subCatRecipesObj.recipes;$scope.subCatRecipesObj.recipes=oldRecipes.concat(onScroll)}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")}),$stateParams.CatIdForRecipes&&CategoryRecipes.query({subCatId:$stateParams.CatIdForRecipes,pageId:pageNumCat}).$promise.then(function(res){$scope.spinnerLoading=!1,pageNumCat++,onScroll=res.recipes,0==res.recipes.length&&($scope.noMoreRecipesAvailable=!0,console.log("Recipes Fully fetched there is no more recipes"));var oldRecipes=$scope.subCatRecipesObj.recipes;$scope.subCatRecipesObj.recipes=oldRecipes.concat(onScroll)}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.LoadMoreRecipesFromFilterBased=function(){console.log("@@#### FILTER FROM LOAD: "),$scope.spinnerLoading=!0;var onScroll={};$stateParams.subCatId&&FilterBySubCats.query({subCatId:$stateParams.subCatId,pageId:pageNumForFilterSubCats}).$promise.then(function(res){$scope.spinnerLoading=!1,pageNumForFilterSubCats++,onScroll=res.recipes,0==res.recipes.length&&($scope.noMoreRecipesAvailable=!0);var oldRecipes=$scope.subCatRecipesObj.recipes;$scope.subCatRecipesObj.recipes=oldRecipes.concat(onScroll)}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")}),$stateParams.CatIdForRecipes&&FilterByCatRecipes.query({subCatId:$stateParams.CatIdForRecipes,pageId:pageNumForFilterCat}).$promise.then(function(res){$scope.spinnerLoading=!1,pageNumForFilterCat++,onScroll=res.recipes,0==res.recipes.length&&($scope.noMoreRecipesAvailable=!0,console.log("Recipes Fully fetched there is no more recipes"));var oldRecipes=$scope.subCatRecipesObj.recipes;$scope.subCatRecipesObj.recipes=oldRecipes.concat(onScroll)}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})}}]).controller("SearchedRecipesCtrl",["$scope","$stateParams","SearchedRecipes","Authentication",function($scope,$stateParams,SearchedRecipes,Authentication){$scope.authentication=Authentication,$scope.vm={currentPage:1},$scope.itemsPerPage=6,$scope.maxSize=5,$scope.searchedQuery=$stateParams.query,$scope.recipesUnderSearchQuery=function(pageNum){$scope.loading=!0,SearchedRecipes.query({pageId:pageNum-1,searchQuery:$stateParams.query},function(res){$scope.loading=!1,1===pageNum&&($scope.totalItems=res.count),$scope.recipes=res.recipes},function(err){$scope.loading=!1,$scope.recipes=[]})},$scope.pageChanged=function(){$scope.recipesUnderSearchQuery($scope.vm.currentPage)}}]),angular.module("recipes").directive("myYoutube",["$sce",function($sce){return{restrict:"EA",scope:{code:"="},replace:!0,template:'<div style="height:350px; width:100%"><iframe style="overflow:hidden;height:100%;width:70%" controls="0" src="{{url}}" frameborder="0" allowfullscreen></iframe></div>',link:function(scope){scope.$watch("code",function(newVal){newVal&&(scope.url=$sce.trustAsResourceUrl("http://www.youtube.com/embed/"+newVal))})}}}]),angular.module("recipes").directive("myFavoriteIcon",["$sce","Authentication","$state","$http","$localStorage","RecipesFavCount","UserFavorites","$modal",function($sce,Authentication,$state,$http,$localStorage,RecipesFavCount,UserFavorites,$modal){return{restrict:"A",scope:{favorite:"="},replace:!0,template:"<i ng-class=\"emptyIcon ? 'fa fa-heart-o' : 'fa fa-heart animatedIcon bounceIn'\" style=\"font-size:20px;padding-left:18%\"></i>",link:function(scope,elem,attrs){elem.on("click",function(){console.log("Recipe favorite dir is called"),scope.$apply(function(){if(Authentication.user)if($http.defaults.headers.common.Authorization="Basic "+$localStorage.token,scope.favorite){if(scope.emptyIcon){console.log("Scope .emptyIcon Recipe favorite dir is called under Authentication "),scope.emptyIcon=!1,Authentication.user.favorites.push(scope.favorite.videoId);var favRecipe=scope.favorite;favRecipe.favoritesCount=scope.favorite.favoritesCount+1,RecipesFavCount.update({recipeId:favRecipe._id},favRecipe,function(res){},function(err){scope.emptyIcon=!0})}else{scope.emptyIcon=!0;var favRecipe=scope.favorite;Authentication.user.favorites.splice(Authentication.user.favorites.indexOf(scope.favorite.videoId),1),favRecipe.favoritesCount=scope.favorite.favoritesCount-1,RecipesFavCount.update({recipeId:favRecipe._id},favRecipe,function(res){},function(err){scope.emptyIcon=!1})}var user={firstName:Authentication.user.firstName,lastName:Authentication.user.lastName,favorites:scope.favorite.videoId,provider:Authentication.user.provider};UserFavorites.update({userId:Authentication.user._id},user,function(res){},function(err){})}else console.log("It is off!");else{$modal.open({templateUrl:"modules/categories/views/modals/userNotLoggedIn-modal.html",backdrop:"static",scope:scope,controller:"LoginSignUpModalCtrl"}).result.then(function(booleanValue){scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/signIn-modal.html",controller:"AuthenticationController",backdrop:"static",scope:scope,resolve:{SignUpCondition:function(){return booleanValue}}})},function(){})}})}),scope.$watch("favorite",function(newVal){if(newVal){var user=Authentication.user;user?-1==user.favorites.indexOf(newVal.videoId)?scope.emptyIcon=!0:scope.emptyIcon=!1:scope.emptyIcon=!0}})}}}]).controller("LoginSignUpModalCtrl",["$scope","$modalInstance","$modal",function($scope,$modalInstance,$modal){$scope.LogInModal=function(){$scope.SignUpCondition=!1,$modalInstance.close()},$scope.SignUpModal=function(){$scope.SignUpCondition=!0,$modalInstance.close($scope.SignUpCondition)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).directive("myLikeIcon",["$sce","Authentication","$state","$http","$localStorage","RecipesFavCount","UserFavorites","$modal",function($sce,Authentication,$state,$http,$localStorage,RecipesFavCount,UserFavorites,$modal){return{restrict:"A",scope:{likes:"="},replace:!0,template:"<i ng-class=\" emptyIcon ? 'fa fa-thumbs-o-up' : 'fa fa-thumbs-up animatedIcon bounceIn'\" style=\"font-size:20px\"></i>",link:function(scope,elem,attrs){elem.on("click",function(){scope.$apply(function(){if(Authentication.user){if($http.defaults.headers.common.Authorization="Basic "+$localStorage.token,scope.likes){if(scope.emptyIcon){scope.emptyIcon=!1,Authentication.user.likes.push(scope.likes.videoId);var favRecipe=scope.likes;favRecipe.applikes=scope.likes.applikes+1,RecipesFavCount.update({recipeId:favRecipe._id},favRecipe,function(res){},function(err){scope.emptyIcon=!0})}else{scope.emptyIcon=!0;var favRecipe=scope.likes;Authentication.user.likes.splice(Authentication.user.likes.indexOf(scope.likes.videoId),1),favRecipe.applikes=scope.likes.applikes-1,RecipesFavCount.update({recipeId:favRecipe._id},favRecipe,function(res){},function(err){scope.emptyIcon=!1})}var user={firstName:Authentication.user.firstName,lastName:Authentication.user.lastName,likes:scope.likes.videoId,provider:Authentication.user.provider};UserFavorites.update({userId:Authentication.user._id},user,function(res){},function(err){scope.emptyIcon=!0})}}else{$modal.open({templateUrl:"modules/categories/views/modals/userNotLoggedIn-modal.html",backdrop:"static",scope:scope,controller:"LoginSignUpModalCtrl"}).result.then(function(booleanValue){scope.modalInstance=$modal.open({templateUrl:"modules/categories/views/modals/signIn-modal.html",controller:"AuthenticationController",backdrop:"static",scope:scope,resolve:{SignUpCondition:function(){return booleanValue}}})},function(){})}})}),scope.$watch("likes",function(newVal){if(newVal){var user=Authentication.user;user?-1==user.likes.indexOf(newVal.videoId)?scope.emptyIcon=!0:scope.emptyIcon=!1:scope.emptyIcon=!0}})}}}]).directive("popover",["$compile",function($compile){return{restrict:"A",link:function(scope,elem){var content=$("#popover-content").html(),compileContent=$compile(content)(scope),title=$("#popover-head").html(),options={content:compileContent,html:!0,title:title,placement:"top"};$(elem).popover(options)}}}]),angular.module("recipes").filter("numeral",function(){return function(count){return numeral(count).format("0.0a")}}).filter("durationFltr",function(){return function(millis){var secNum=Math.floor(millis/60),secTxt=millis%60,minNum=Math.floor(secNum/60),minTxt=secNum%60,hourTxt=(Math.floor(minNum/60),minNum);return 0==hourTxt?minTxt+"m:"+secTxt+"s":hourTxt+"h:"+minTxt+"m:"+secTxt+"s"}}),angular.module("recipes").factory("Vrecipes",["$resource",function($resource){return{getrecipes:$resource("/VRecipesByCategoriesForAdmin/:CategoryName",{CategoryName:"@CategoryName"},{query:{method:"GET",isArray:!0}}),updaterecipes:$resource("/vrecipes/:vrecipeId",{vrecipeId:"@vrecipeId"},{update:{method:"PUT"}}),getcategory:$resource("/categories/admincats",{},{query:{method:"GET",isArray:!0}}),savecategory:$resource("/newcategories",{},{save:{method:"POST"}})}}]).factory("CategoryRecipes",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/newRecipesForCatId/:subCatId/:pageId",{subCatId:"@subCatId",pageId:"@pageId"},{query:{method:"GET",timeout:2e4}})}]).factory("FilterByCatRecipes",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/newRecipesForFilterCatId/:subCatId/:pageId",{subCatId:"@subCatId",pageId:"@pageId"},{query:{method:"GET",timeout:2e4}})}]).factory("SubCategoryRecipes",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/newRecipesForSubCatId/:subCatId/:pageId",{subCatId:"@subCatId",pageId:"@pageId"},{query:{method:"GET",timeout:2e4}})}]).factory("FilterBySubCats",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/newRecipesForFilterSubCatId/:subCatId/:pageId",{subCatId:"@subCatId",pageId:"@pageId"},{query:{method:"GET",timeout:2e4}})}]).factory("SearchedRecipes",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/searchedVRecipesByIndexNew/:searchQuery/:pageId",{searchQuery:"@searchQuery",pageId:"@pageId"},{query:{method:"GET",timeout:2e4}})}]).factory("Recipe",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/nVRecipes/:vrecipeId",{vrecipeId:"@vrecipeId"},{get:{method:"GET",timeout:2e4},save:{method:"POST"},update:{method:"PUT"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},delete:{method:"DELETE"}})}]).factory("RecipesFavCount",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/recipesFavCount/:recipeId",{recipeId:"@_id"},{update:{method:"PUT"}})}]).factory("UserFavorites",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/userFavorites/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]).factory("MyFavRecipes",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/WebFavRecipes/:uId/:pageId",{uId:"@uId",pageId:"@pageId"},{query:{method:"GET"}})}]).factory("UserSuggestion",["$resource","ConfigService",function($resource,ConfigService){return $resource(ConfigService.API_URL+"/users/suggestions/:pageId",{pageId:"@pageId"},{get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},delete:{method:"DELETE"}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin")}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/login",templateUrl:"modules/users/views/authentication/signin.client.view.html",
module:"public",data:{bodyClass:"bg-body"}}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html",module:"public",data:{bodyClass:"bg-body"}}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"}).state("reciflix.users",{url:"users",templateUrl:"modules/users/views/users.html",controller:"UsersCtrl",module:"private"})}]).run(["$rootScope","$state","$stateParams",function($rootScope,$state,$stateParams){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication","$localStorage","Users","$state","$modalInstance","SignUpCondition","NotificationFactory",function($scope,$http,$location,Authentication,$localStorage,Users,$state,$modalInstance,SignUpCondition,NotificationFactory){$scope.authentication=Authentication,$scope.authentication.user&&$state.go("reciflix.recipes"),navigator.userAgent.match(/Android/i)?$scope.androidUser=!0:(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))&&($scope.iosUser=!0),$scope.buttonTextLogIn="Log In",$scope.buttonTextSignUp="Sign Up",SignUpCondition&&($scope.condition1=SignUpCondition),$scope.Login=function(){$scope.isDisabled=!0,$scope.buttonTextLogIn="Logging In...",Users.Login.create($scope.credentials).$promise.then(function(res){!1===res.type?($scope.errMsg=res.data,$scope.isDisabled=!1,$scope.buttonTextLogIn="Log In"):($scope.errMsg=!1,$scope.populateUserLocally(res))}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please try after sometime!")})},$scope.SignUp=function(){$scope.buttonTextSignUp="Signing Up...",$scope.isDisabled=!0,Users.Signup.create($scope.user).$promise.then(function(res){!1===res.type?($scope.errMsg=res.data,$scope.isDisabled=!1,$scope.buttonTextSignUp="Sign Up"):($scope.errMsg=!1,$scope.populateUserLocally(res))}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please try after sometime!")})},hello.init({google:"512199517355-keu3sicfllh719ghbveivg6ic40lq4dr.apps.googleusercontent.com",facebook:"1607966326154856"},{scope:"email"}),$scope.populateUserLocally=function(respUser){$scope.authentication.user=respUser,$localStorage.user=respUser,$localStorage.token=respUser.token,$localStorage.reciflix_visited=!0,$scope.modalInstance.close(),NotificationFactory.success("Hi "+respUser.displayName,"Authentication Success !"),"home"===$state.current.name?$state.go("reciflix.recipes"):$state.go($state.current)},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.googleAuthLogIn=function(){hello("google").login({scope:"email",force:!1}).then(function(gRes){$http({method:"GET",url:"https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token="+gRes.authResponse.access_token,data:null,dataType:"json"}).success(function(data){$scope.gUser={firstName:data.given_name,lastName:data.family_name,email:data.email,provider:"gmail"},Users.Signup.create($scope.gUser).$promise.then(function(res){!1===res.type?($scope.errMsg=res.data,$scope.populateUserLocally(res.user)):($scope.errMsg=!1,$scope.populateUserLocally(res))}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please try after sometime!")})}).error(function(data,status){$scope.errMsg="This seems to be Google login error. We willl look into it and let you know"})})},$scope.fbAuthLogIn=function(){hello("facebook").login().then(function(fbRes){$http({method:"GET",url:"https://graph.facebook.com/me?fields=email,first_name,gender,id,last_name&access_token="+fbRes.authResponse.access_token,data:null,dataType:"json"}).success(function(data){$scope.fUser={firstName:data.first_name,lastName:data.last_name,email:data.email,provider:"fb"},Users.Signup.create($scope.fUser).$promise.then(function(res){!1===res.type?($scope.errMsg=res.data,$scope.populateUserLocally(res.user)):($scope.errMsg=!1,$scope.populateUserLocally(res))}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please try after sometime!")})}).error(function(data,status){$scope.errMsg="This seems to be Google login error. We willl look into it and let you know"})},function(e){console.log("Signin error: "+e.error.message)})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication","$localStorage",function($scope,$stateParams,$http,$location,Authentication,$localStorage){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,console.log("Password reset conformation :"+JSON.stringify(response)),Authentication.user=response,$localStorage.token=response.token,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http.delete("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;new Users($scope.user).$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("UsersCtrl",["$scope","$state","Users","$rootScope",function($scope,$state,Users,$rootScope,$localStorage){var usageCount="UC",totalUsersCount="TUC",userSuggestions="US";$scope.getAllUsers=function(pageNum){Users.AllUsers.query({pageId:pageNum-1+totalUsersCount}).$promise.then(function(res){$scope.users=res.users,$scope.itemsPerPage=5,$scope.maxSize=5,$scope.totalItems=res.count,"TUC"===totalUsersCount&&(totalUsersCount+=res.count),$rootScope.pageNumStore>1?($scope.vm.currentPage=$rootScope.pageNumStore,$rootScope.pageNumStore=1):$scope.vm={currentPage:1}}).catch(function(err){})},$scope.getUsageDetails=function(pageNum){Users.UsageDetails.query({pageId:pageNum-1+usageCount}).$promise.then(function(res){$scope.usageDetails=res.details,$scope.totalItems1=res.count,"UC"===usageCount&&(usageCount+=res.count),$scope.itemsPerPage1=5,$scope.maxSize1=5,$rootScope.pageNumStore1>1?($scope.vm.currentPage1=$rootScope.pageNumStore1,$rootScope.pageNumStore1=1):$scope.vm={currentPage1:1}}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.pageChanged1=function(){1===$scope.vm.currentPage1?$scope.getUsageDetails($scope.vm.currentPage1):($rootScope.pageNumStore1=$scope.vm.currentPage1,$scope.getUsageDetails($scope.vm.currentPage1))},$scope.pageChanged=function(){1===$scope.vm.currentPage?$scope.getAllUsers($scope.vm.currentPage):($rootScope.pageNumStore=$scope.vm.currentPage,$scope.getAllUsers($scope.vm.currentPage))},$scope.getUsersSuggestions=function(pageNum){Users.UsersSuggestion.query({pageId:pageNum-1+userSuggestions}).$promise.then(function(res){$scope.suggestions=res.suggestions,$scope.totalItems2=res.count,"US"===userSuggestions&&(userSuggestions+=res.count),$scope.itemsPerPage2=5,$scope.maxSize2=5,$rootScope.pageNumStore2>1?($scope.vm.currentPage2=$rootScope.pageNumStore2,$rootScope.pageNumStore2=1):$scope.vm={currentPage2:1}}).catch(function(err){alert("Looks like there is an issue with your connectivity, Please check your network connection or Please try after sometime!")})},$scope.pageChanged2=function(){1===$scope.vm.currentPage2?$scope.getUsersSuggestions($scope.vm.currentPage2):($rootScope.pageNumStore2=$scope.vm.currentPage2,$scope.getUsersSuggestions($scope.vm.currentPage2))}}]),angular.module("users").factory("Authentication",["$window",function($window){return{user:$window.user}}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]).factory("SignUpCondition",function(){return!1}).factory("Users",["$resource","ConfigService",function($resource,ConfigService,$localStorage){return{Signup:$resource(ConfigService.API_URL+"/users/signup",{},{create:{method:"POST",timeout:3e4}}),Login:$resource(ConfigService.API_URL+"/users/signin",{},{create:{method:"POST",timeout:2e4}}),AllUsers:$resource(ConfigService.API_URL+"/users/totalUsers/:pageId",{pageId:"@pageId"},{query:{method:"GET",timeout:2e4}}),UsageDetails:$resource(ConfigService.API_URL+"/users/usage-details-collection/:pageId",{pageId:"@pageId"},{query:{method:"GET",timeout:2e4}}),UsersSuggestion:$resource(ConfigService.API_URL+"/users/suggestions/:pageId",{pageId:"@pageId"},{query:{method:"GET",timeout:2e4}})}}]);
